<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Star Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{
      --bg:#111822; --card:#1a2330; --muted:#9fb3c8; --accent:#2ea6ff; --accent2:#00d0a8;
      --danger:#ff4d6d; --text:#e7f0f8; --glow:#2ea6ff55;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
    .wrap{padding:14px 14px 90px}
    .header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    .avatar{width:40px;height:40px;border-radius:50%;background:#263244;display:flex;align-items:center;justify-content:center;font-weight:700}
    .title{flex:1}
    .title h1{margin:0;font-size:18px}
    .title small{color:var(--muted)}
    .stars{margin-left:auto;display:flex;align-items:center;gap:8px}
    .pill{display:flex;align-items:center;gap:6px;background:var(--card);padding:8px 10px;border-radius:999px}
    .plus{width:36px;height:36px;border-radius:999px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:grid;place-items:center;font-weight:800}

    .carousel{display:grid;grid-template-columns:repeat(6, 1fr);gap:12px;overflow-x:auto;padding-bottom:4px;scroll-snap-type:x mandatory}
    .item{min-width:130px;scroll-snap-align:start;background:var(--card);border-radius:var(--radius);padding:14px;position:relative}
    .emj{font-size:40px;display:block;margin-bottom:6px}
    .iname{font-weight:700}
    .iprice{color:#ffd15c;font-weight:700;margin-top:6px}
    .glow{position:absolute;inset:-1px;border-radius:var(--radius);box-shadow:0 0 0 0 var(--glow);pointer-events:none;transition:.2s}

    .panel{background:var(--card);border-radius:var(--radius);padding:12px;margin-top:12px}
    .row{display:flex;gap:8px;align-items:center;justify-content:space-between}
    .chips{display:flex;gap:8px}
    .chip{padding:10px 12px;border-radius:12px;background:#1f2a3a;color:var(--text);min-width:40px;text-align:center}
    .chip.active{background:linear-gradient(135deg,var(--accent),var(--accent2));font-weight:700}
    .toggle{display:flex;align-items:center;gap:10px;color:var(--muted)}
    .switch{appearance:none;width:44px;height:26px;border-radius:999px;background:#2a374c;position:relative;outline:none;cursor:pointer}
    .switch:checked{background:var(--accent2)}
    .switch::after{content:"";position:absolute;top:3px;left:3px;width:20px;height:20px;border-radius:50%;background:#fff;transition:.2s}
    .switch:checked::after{left:21px}

    .cta{position:fixed;left:12px;right:12px;bottom:14px}
    .btn{width:100%;border:none;border-radius:14px;padding:16px 18px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;font-weight:800;font-size:16px;box-shadow:0 10px 24px #0005}

    /* overlay roll */
    .overlay{position:fixed;inset:0;background:#0008;display:none;align-items:center;justify-content:center;z-index:10}
    .cardRoll{width:240px;height:240px;background:var(--card);border-radius:20px;display:grid;place-items:center;position:relative;box-shadow:0 20px 40px #0008}
    .chest{font-size:72px;animation:pulse 1s infinite}
    .hint{position:absolute;bottom:10px;color:var(--muted);font-size:12px}
    @keyframes pulse {0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)}}

    /* confetti */
    .confetti{position:absolute;inset:0;overflow:hidden;pointer-events:none}
    .c{position:absolute;width:8px;height:8px;background:#fff;border-radius:2px;opacity:0;animation:fall 1.2s ease-out forwards}
    @keyframes fall{
      0%{transform:translateY(-20px) rotate(0);opacity:0}
      10%{opacity:1}
      100%{transform:translateY(240px) rotate(540deg);opacity:0}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="avatar" id="uav">U</div>
      <div class="title">
        <h1>Easy Star</h1>
        <small id="usm">Mini App</small>
      </div>
      <div class="stars">
        <div class="pill"><span>‚≠ê</span><b id="stubal">‚Äî</b></div>
        <div class="plus" id="add">+</div>
      </div>
    </div>

    <div class="carousel" id="list">
      <!-- –Ω–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–∑ items[] -->
    </div>

    <div class="panel">
      <div class="row">
        <div class="chips" id="chips">
          <div class="chip active" data-n="1">1</div>
          <div class="chip" data-n="2">2</div>
          <div class="chip" data-n="3">3</div>
          <div class="chip" data-n="4">4</div>
          <div class="chip" data-n="5">5</div>
        </div>
        <label class="toggle">
          <input type="checkbox" class="switch" id="fast">
          Fast
        </label>
      </div>
    </div>

    <div class="cta"><button class="btn" id="spin">Try Your Luck - <span id="price">30</span> ‚≠ê</button></div>
  </div>

  <!-- overlay roll -->
  <div class="overlay" id="ov">
    <div class="cardRoll">
      <div class="chest">üß∞</div>
      <div class="confetti" id="conf"></div>
      <div class="hint">–°–º–æ—Ç—Ä–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —á–∞—Ç–µ‚Ä¶</div>
    </div>
  </div>

<script>
  const tg = window.Telegram.WebApp; tg.expand(); tg.ready();
  // minimal user info in header
  const u = tg.initDataUnsafe?.user || {};
  document.getElementById('uav').textContent = (u.first_name||'U').slice(0,1).toUpperCase();
  document.getElementById('usm').textContent = u.username ? '@'+u.username : 'Mini App';

  // –¢–≤–æ–π —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–∑–æ–≤: –∫–ª—é—á, —ç–º–æ–¥–∑–∏, —Ü–µ–Ω–∞ (–¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –±–æ—Ç–æ–º)
  const items = [
    {key:'diamond_100', e:'üíé', p:100, t:'–ë—Ä–∏–ª–ª–∏–∞–Ω—Ç'},
    {key:'ring_100',    e:'üíç', p:100, t:'–ö–æ–ª—å—Ü–æ'},
    {key:'trophy_100',  e:'üèÜ', p:100, t:'–ö—É–±–æ–∫'},
    {key:'rocket_50',   e:'üöÄ', p:50,  t:'–†–∞–∫–µ—Ç–∞'},
    {key:'bouquet_50',  e:'üíê', p:50,  t:'–ë—É–∫–µ—Ç'},
    {key:'cake_50',     e:'üéÇ', p:50,  t:'–¢–æ—Ä—Ç'},
    {key:'champagne_50',e:'üçæ', p:50,  t:'–®–∞–º–ø–∞–Ω—Å–∫–æ–µ'},
    {key:'present_25',  e:'üéÅ', p:25,  t:'–ü–æ–¥–∞—Ä–æ–∫'},
    {key:'rose_25',     e:'üåπ', p:25,  t:'–†–æ–∑–∞'},
    {key:'bear_15',     e:'üß∏', p:15,  t:'–ú–∏—à–∫–∞'},
    {key:'heart_15',    e:'‚ù§Ô∏è', p:15,  t:'–°–µ—Ä–¥—Ü–µ'},
    {key:'nft_rare',    e:'üßø', p:0,   t:'NFT (—Ä–µ–¥–∫–∏–π)'},
  ];

  // –†–µ–Ω–¥–µ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫
  const list = document.getElementById('list');
  items.forEach(it=>{
    const el = document.createElement('div');
    el.className = 'item';
    el.innerHTML = `
      <div class="emj">${it.e}</div>
      <div class="iname">${it.t}</div>
      <div class="iprice">${it.p?('‚≠ê '+it.p):'rare'}</div>
      <div class="glow"></div>`;
    list.appendChild(el);
  });

  // –í—ã–±–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–ø–∏–Ω–æ–≤
  let spins = 1; const chips = document.querySelectorAll('#chips .chip');
  chips.forEach(c=>c.onclick=()=>{
    chips.forEach(x=>x.classList.remove('active'));
    c.classList.add('active');
    spins = parseInt(c.dataset.n||'1',10);
  });

  // –¶–µ–Ω–∞ —Å–ø–∏–Ω–∞ (–ø–æ–º–µ–Ω—è–π, –µ—Å–ª–∏ —Å–º–µ–Ω–∏—à—å –≤ –±–æ—Ç–µ)
  let PRICE = 30;
  document.getElementById('price').textContent = PRICE;

  // –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–µ–Ω—é –±–∞–ª–∞–Ω—Å–∞ –≤ —á–∞—Ç–µ
  document.getElementById('add').onclick = ()=>{
    tg.HapticFeedback?.impactOccurred?.('medium');
    tg.sendData(JSON.stringify({a:'balance_menu'}));
  };

  // –ê–Ω–∏–º–∞—Ü–∏—è —Ä–æ–ª–ª–∞
  const ov = document.getElementById('ov');
  const conf = document.getElementById('conf');
  function showAnim(ms=1600){
    ov.style.display='flex';
    conf.innerHTML='';
    // –Ω–µ–º–Ω–æ–≥–æ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
    for(let i=0;i<30;i++){
      const d=document.createElement('div');
      d.className='c';
      d.style.left=(10+Math.random()*220)+'px';
      d.style.top=(20+Math.random()*20)+'px';
      d.style.background=['#ffd15c','#2ea6ff','#00d0a8','#ff6ea8'][i%4];
      d.style.animationDelay=(0.2+Math.random()*0.5)+'s';
      conf.appendChild(d);
    }
    setTimeout(()=>{ ov.style.display='none'; }, ms);
  }

  // Spin
  const fast = document.getElementById('fast');
  document.getElementById('spin').onclick = ()=>{
    tg.HapticFeedback?.impactOccurred?.('heavy');
    const ms = fast.checked ? 800 : 1800;
    showAnim(ms);
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –≤ –±–æ—Ç–∞: –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–∏–Ω
    tg.sendData(JSON.stringify({a:'spin', n: spins}));
  };

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ‚Äú–±–∞–ª–∞–Ω—Å–∞‚Äù –≤ —à–∞–ø–∫–µ ‚Äî –¥–µ—Ä–∂–∏–º –ø—Ä–æ—á–µ—Ä–∫, –æ–Ω –≤—Å—ë —Ä–∞–≤–Ω–æ –≤ —á–∞—Ç–µ
  document.getElementById('stubal').textContent = '‚Äî';
</script>
</body>
</html>
