 <!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Easy Star</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root{--bg:#101720;--card:#17202b;--soft:#1e2a38;--muted:#a6b7c7;--text:#eaf3fb;--acc1:#2ea6ff;--acc2:#00d0a8;--star:#ffd15c;--r:14px}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
.wrap{padding-bottom:96px}
.header{display:flex;align-items:center;gap:12px;padding:12px 14px}
.ava{width:42px;height:42px;border-radius:50%;background:#253348;display:grid;place-items:center;font-weight:800}
.title{flex:1}.title h1{margin:0;font-size:18px}.title small{color:var(--muted)}
.pill{display:flex;gap:8px;align-items:center;background:var(--card);border-radius:999px;padding:8px 10px}
.plus{width:36px;height:36px;display:grid;place-items:center;border-radius:999px;background:linear-gradient(135deg,var(--acc1),var(--acc2));font-weight:800;cursor:pointer}
.tabs{display:flex;gap:10px;padding:0 14px}
.tab{flex:1;background:var(--card);border-radius:12px;padding:10px 12px;display:flex;justify-content:space-between;align-items:center;cursor:pointer}
.tab.active{outline:2px solid #2ea6ff66}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:12px 14px}
.case{background:var(--card);border-radius:var(--r);padding:14px;position:relative;cursor:pointer}
.badge{position:absolute;top:8px;right:8px;font-size:12px;background:#273447;color:#9cd;padding:4px 6px;border-radius:10px}
.pic{font-size:48px;margin-bottom:8px}
.nm{font-weight:800;margin:0 0 4px}.desc{color:var(--muted);font-size:13px;margin-bottom:8px}
.price{display:flex;align-items:center;gap:6px;color:var(--star);font-weight:800}
.open{margin-top:8px;width:100%;border:none;border-radius:12px;padding:10px;background:linear-gradient(135deg,var(--acc1),var(--acc2));color:#fff;font-weight:800;cursor:pointer}
.panel{position:fixed;left:0;right:0;bottom:56px;background:var(--soft);border-top-left-radius:16px;border-top-right-radius:16px;padding:10px 12px}
.chips{display:flex;gap:8px;margin-bottom:10px}
.chip{flex:1;background:#233041;padding:10px 0;border-radius:12px;text-align:center;cursor:pointer}
.chip.active{background:linear-gradient(135deg,var(--acc1),var(--acc2));font-weight:800}
.row{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.switch{appearance:none;width:44px;height:26px;border-radius:999px;background:#2a374c;position:relative;cursor:pointer}
.switch:checked{background:var(--acc2)}.switch:after{content:"";position:absolute;top:3px;left:3px;width:20px;height:20px;border-radius:50%;background:#fff;transition:.2s}
.switch:checked:after{left:21px}
.btn{width:100%;border:none;border-radius:14px;padding:16px;background:linear-gradient(135deg,var(--acc1),var(--acc2));color:#fff;font-weight:800;box-shadow:0 10px 24px #0006;cursor:pointer}
.nav{position:fixed;left:0;right:0;bottom:0;height:56px;background:var(--card);display:flex;justify-content:space-around;align-items:center}
.nav .item{width:20%;text-align:center;cursor:pointer}.nav .item span{display:block;font-size:12px;color:var(--muted)}
.ov{position:fixed;inset:0;background:#0007;display:none;align-items:center;justify-content:center;z-index:10}
.card{width:280px;min-height:220px;background:var(--card);border-radius:16px;padding:16px;text-align:center;box-shadow:0 20px 40px #0008}
.big{font-size:64px;margin:0 0 8px}
.items{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px}
.cell{background:var(--soft);border-radius:10px;padding:8px 4px}
.mut{color:var(--muted);font-size:12px;margin-top:6px}
.modal{position:fixed;inset:0;background:#0007;display:none;align-items:center;justify-content:center;z-index:11}
.box{width:300px;max-width:92vw;background:var(--card);border-radius:16px;padding:14px}
.box h3{margin:0 0 8px}
.list .rowi{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #223142}
.close{margin-top:10px;width:100%;border:none;border-radius:12px;padding:10px;background:#233041;color:#fff}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div class="ava" id="ava">U</div>
    <div class="title"><h1>Easy Star</h1><small id="uname">@user</small></div>
    <div class="pill"><span>‚≠ê</span><b id="bal">‚âà 0</b></div>
    <div class="plus" id="add">+</div>
  </div>

  <div class="tabs">
    <div class="tab active" id="tabClassic"><b>Classic</b><span>30‚≠ê</span></div>
    <div class="tab" id="tabLucky"><b>Lucky</b><span>45‚≠ê</span></div>
  </div>

  <div class="grid" id="grid"></div>

  <div class="panel">
    <div class="chips" id="chips">
      <div class="chip active" data-n="1">1</div><div class="chip" data-n="2">2</div>
      <div class="chip" data-n="3">3</div><div class="chip" data-n="4">4</div>
      <div class="chip" data-n="5">5</div>
    </div>
    <div class="row"><div class="mut">Fast</div><input type="checkbox" id="fast" class="switch"/></div>
    <button class="btn" id="spin">Try Your Luck ‚Äî <span id="price">30</span> ‚≠ê</button>
  </div>

  <div class="nav">
    <div class="item" id="navHome">üéÅ<span>Home</span></div>
    <div class="item" id="navUpg">üõ†Ô∏è<span>Upgrade</span></div>
    <div class="item" id="navLead">üèÜ<span>Leaders</span></div>
    <div class="item" id="navProf">üë§<span>Profile</span></div>
    <div class="item" id="navHist">üïì<span>History</span></div>
  </div>
</div>

<!-- —Ä–µ–∑—É–ª—å—Ç–∞—Ç -->
<div class="ov" id="ov"><div class="card"><div class="big" id="big">üéÅ</div><b id="ttl">–ü–æ–¥–∞—Ä–æ–∫</b><div class="items" id="multi"></div><div class="mut">–ò—Ç–æ–≥ –≤ —á–∞—Ç–µ</div></div></div>

<!-- —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–µ–π—Å–∞ -->
<div class="modal" id="mdl"><div class="box">
  <h3 id="mh">Classic Case</h3>
  <div class="list" id="list"></div>
  <button class="close" id="mclose">–ó–∞–∫—Ä—ã—Ç—å</button>
</div></div>

<script>
const tg=window.Telegram.WebApp; tg.expand(); tg.ready();
const u=tg.initDataUnsafe?.user||{}; document.getElementById('ava').textContent=(u.first_name||'U').slice(0,1).toUpperCase();
document.getElementById('uname').textContent=u.username?('@'+u.username):'Mini App';

// –ª–æ–∫–∞–ª—å–Ω—ã–π ‚Äú‚âà –±–∞–ª–∞–Ω—Å‚Äù
let localBal=0; const balEl=document.getElementById('bal'); function setBal(x){ balEl.textContent='‚âà '+x; }

// –∫–µ–π—Å—ã
const CASES={
  classic:{name:'Classic Case',desc:'–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π',price:30,emoji:'üéÅ'},
  lucky:{name:'Lucky Case',desc:'–ë–æ–ª—å—à–µ –¥–æ—Ä–æ–≥–∏—Ö',price:45,emoji:'üí†'}
};
let current='classic'; let spins=1;

// –ø—Ä–µ–¥–º–µ—Ç—ã
const ITEMS=[{k:'diamond_100',e:'üíé',t:'–ë—Ä–∏–ª–ª–∏–∞–Ω—Ç',p:100},{k:'ring_100',e:'üíç',t:'–ö–æ–ª—å—Ü–æ',p:100},{k:'trophy_100',e:'üèÜ',t:'–ö—É–±–æ–∫',p:100},{k:'rocket_50',e:'üöÄ',t:'–†–∞–∫–µ—Ç–∞',p:50},{k:'bouquet_50',e:'üíê',t:'–ë—É–∫–µ—Ç',p:50},{k:'cake_50',e:'üéÇ',t:'–¢–æ—Ä—Ç',p:50},{k:'champagne_50',e:'üçæ',t:'–®–∞–º–ø–∞–Ω—Å–∫–æ–µ',p:50},{k:'present_25',e:'üéÅ',t:'–ü–æ–¥–∞—Ä–æ–∫',p:25},{k:'rose_25',e:'üåπ',t:'–†–æ–∑–∞',p:25},{k:'bear_15',e:'üß∏',t:'–ú–∏—à–∫–∞',p:15},{k:'heart_15',e:'‚ù§Ô∏è',t:'–°–µ—Ä–¥—Ü–µ',p:15},{k:'nft_rare',e:'üßø',t:'NFT (—Ä–µ–¥–∫–∏–π)',p:0}];

// —à–∞–Ω—Å—ã –¥–ª—è –≤–∏–∑—É–∞–ª–∞ (–∫–∞–∫ —Ä–∞–Ω—å—à–µ, ‚Äú–∫—Ä–∞—Å–∏–≤—ã–µ‚Äù)
const PROBS_C={"heart_15":0.30,"bear_15":0.20,"present_25":0.15,"rose_25":0.08,"cake_50":0.07,"bouquet_50":0.06,"rocket_50":0.05,"champagne_50":0.04,"trophy_100":0.02,"ring_100":0.015,"diamond_100":0.01,"nft_rare":0.005};
const PROBS_L={"heart_15":0.24,"bear_15":0.18,"present_25":0.14,"rose_25":0.09,"cake_50":0.07,"bouquet_50":0.07,"rocket_50":0.07,"champagne_50":0.06,"trophy_100":0.03,"ring_100":0.02,"diamond_100":0.014,"nft_rare":0.01};

function drawCases(){
  const g=document.getElementById('grid');
  g.innerHTML = ['classic','lucky'].map(k=>{
    const c=CASES[k], badge=(k==='classic'?'Default':'New');
    const contentBtn=`<button class="open" data-show="${k}">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ</button>`;
    const openBtn=`<button class="open" data-open="${k}">–û—Ç–∫—Ä—ã—Ç—å –∑–∞ ${c.price} ‚≠ê</button>`;
    return `<div class="case" data-case="${k}">
      <div class="badge">${badge}</div>
      <div class="pic">${c.emoji}</div>
      <div class="nm">${c.name}</div>
      <div class="desc">${c.desc}</div>
      <div class="price"><span>‚≠ê</span><b>${c.price}</b></div>
      ${contentBtn}${openBtn}
    </div>`;
  }).join('');
  // –∫–ª–∏–∫–∏ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ ‚Äî –≤—ã–±–æ—Ä –∫–µ–π—Å–∞
  g.querySelectorAll('.case').forEach(el=>{
    el.addEventListener('click', (e)=>{
      // –µ—Å–ª–∏ –ø–æ–ø–∞–ª–∏ –≤ –∫–Ω–æ–ø–∫—É ‚Äî –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç—Å—è –Ω–∏–∂–µ
      if(e.target && (e.target.dataset.open || e.target.dataset.show)) return;
      selectCase(el.dataset.case);
    })
  });
  // –∫–Ω–æ–ø–∫–∞ ‚Äú–û—Ç–∫—Ä—ã—Ç—å‚Äù
  g.querySelectorAll('button[data-open]').forEach(btn=>{
    btn.onclick=(e)=>{ e.stopPropagation(); selectCase(btn.dataset.open); doSpin(); };
  });
  // –∫–Ω–æ–ø–∫–∞ ‚Äú–°–æ–¥–µ—Ä–∂–∏–º–æ–µ‚Äù
  g.querySelectorAll('button[data-show]').forEach(btn=>{
    btn.onclick=(e)=>{ e.stopPropagation(); showContents(btn.dataset.show); };
  });
}
drawCases();

function selectCase(k){
  current=k;
  document.getElementById('tabClassic').classList.toggle('active', k==='classic');
  document.getElementById('tabLucky').classList.toggle('active', k==='lucky');
  priceEl.textContent = CASES[current].price*spins;
  tg.HapticFeedback?.impactOccurred?.('light');
}
document.getElementById('tabClassic').onclick=()=>selectCase('classic');
document.getElementById('tabLucky').onclick=()=>selectCase('lucky');

// —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–µ–π—Å–∞ (–º–æ–¥–∞–ª)
const mdl=document.getElementById('mdl'), list=document.getElementById('list'), mh=document.getElementById('mh');
document.getElementById('mclose').onclick=()=>mdl.style.display='none';
function showContents(k){
  mh.textContent = CASES[k].name;
  list.innerHTML = ITEMS.map(it=>`<div class="rowi"><div>${it.e} ${it.t}</div><b>${it.p?('‚≠ê '+it.p):'rare'}</b></div>`).join('');
  mdl.style.display='flex';
}

// –±–∞–ª–∞–Ω—Å: –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ —á–∞—Ç–µ (–∏ ‚Äú—Å–∏–Ω—Ö‚Äù)
document.getElementById('add').onclick=()=>{ tg.sendData(JSON.stringify({a:'balance_menu'})); };

// —Å–ø–∏–Ω—ã 1‚Äì5
document.querySelectorAll('#chips .chip').forEach(ch=>{
  ch.onclick=()=>{
    document.querySelectorAll('#chips .chip').forEach(x=>x.classList.remove('active'));
    ch.classList.add('active'); spins=parseInt(ch.dataset.n||'1',10);
    priceEl.textContent = CASES[current].price*spins;
  };
});
const priceEl=document.getElementById('price'); priceEl.textContent = CASES[current].price*spins;

// –æ–≤–µ—Ä–ª–µ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
const ov=document.getElementById('ov'), big=document.getElementById('big'), ttl=document.getElementById('ttl'), multi=document.getElementById('multi');
function showRes(keys){
  ov.style.display='flex';
  if(keys.length===1){
    const it=ITEMS.find(x=>x.k===keys[0])||{e:'üéÅ',t:'–ü–æ–¥–∞—Ä–æ–∫'};
    big.textContent=it.e; ttl.textContent=it.t; multi.innerHTML='';
  }else{
    big.textContent='üéâ'; ttl.textContent='–†–µ–∑—É–ª—å—Ç–∞—Ç—ã'; multi.innerHTML='';
    keys.forEach(k=>{
      const it=ITEMS.find(x=>x.k===k)||{e:'üéÅ',t:'–ü–æ–¥–∞—Ä–æ–∫'};
      const d=document.createElement('div'); d.className='cell';
      d.innerHTML=`<div style="font-size:28px">${it.e}</div><div style="font-size:12px">${it.t}</div>`;
      multi.appendChild(d);
    });
  }
  setTimeout(()=>{ov.style.display='none';}, 1400);
}

// –ø—Ä–æ—Å—Ç–∞—è –ª–æ–∫–∞–ª—å–Ω–∞—è —Ä—É–ª–µ—Ç–∫–∞ (–≤–∏–∑—É–∞–ª)
function wPick(probs){ const keys=Object.keys(probs); let r=Math.random(),acc=0; for(const k of keys){acc+=probs[k]; if(r<acc) return k} return keys[keys.length-1] }
function doSpin(){
  const cfg=current==='classic'?{probs:PROBS_C}: {probs:PROBS_L};
  const keys=[]; for(let i=0;i<spins;i++) keys.push(wPick(cfg.probs));
  showRes(keys);
  // –≤–∏–∑—É–∞–ª—å–Ω–æ —É–º–µ–Ω—å—à–∏–º –ª–æ–∫–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å
  localBal = Math.max(0, localBal - CASES[current].price*spins);
  setBal(localBal);
  tg.HapticFeedback?.impactOccurred?.(document.getElementById('fast').checked?'light':'heavy');
  tg.sendData(JSON.stringify({a:'spin', case: current, n: spins, fast: document.getElementById('fast').checked}));
}
document.getElementById('spin').onclick=doSpin;

// –Ω–∞–≤–∏–≥–∞—Ü–∏—è
document.getElementById('navProf').onclick=()=>tg.sendData(JSON.stringify({a:'inventory'}));
document.getElementById('navHome').onclick=()=>window.scrollTo({top:0,behavior:'smooth'});
document.getElementById('navUpg').onclick=()=>tg.sendData(JSON.stringify({a:'balance_menu'}));
document.getElementById('navLead').onclick=()=>tg.sendData(JSON.stringify({a:'inventory'}));
document.getElementById('navHist').onclick=()=>tg.sendData(JSON.stringify({a:'inventory'}));

// –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
setBal(localBal);
</script>
</body>
</html>
