<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Easy Star</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{
      --bg:#101720; --card:#17202b; --soft:#1e2a38; --muted:#a6b7c7; --text:#eaf3fb;
      --acc1:#2ea6ff; --acc2:#00d0a8; --star:#ffd15c; --r:14px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
    .wrap{padding-bottom:90px}
    .header{display:flex;align-items:center;gap:12px;padding:12px 14px}
    .ava{width:42px;height:42px;border-radius:50%;background:#253348;display:grid;place-items:center;font-weight:800}
    .title{flex:1}
    .title h1{margin:0;font-size:18px}
    .title small{color:var(--muted)}
    .pill{display:flex;gap:8px;align-items:center;background:var(--card);border-radius:999px;padding:8px 10px}
    .plus{width:36px;height:36px;display:grid;place-items:center;border-radius:999px;background:linear-gradient(135deg,var(--acc1),var(--acc2));font-weight:800}
    .tabs{display:flex;gap:10px;padding:0 14px}
    .tab{flex:1;background:var(--card);border-radius:12px;padding:12px;display:flex;justify-content:space-between;align-items:center}
    .tab b{font-size:14px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:12px 14px}
    .case{background:var(--card);border-radius:var(--r);padding:14px;position:relative}
    .case .nm{font-weight:800;margin:0 0 6px}
    .case .pr{color:var(--muted);display:flex;justify-content:space-between}
    .badge{position:absolute;top:8px;right:8px;font-size:12px;background:#273447;color:#9cd; padding:4px 7px;border-radius:10px}
    .panel{position:fixed;left:0;right:0;bottom:0;background:var(--soft);border-top-left-radius:16px;border-top-right-radius:16px;padding:10px 12px}
    .chips{display:flex;gap:8px;margin-bottom:10px}
    .chip{flex:1;background:#233041;padding:10px 0;border-radius:12px;text-align:center}
    .chip.active{background:linear-gradient(135deg,var(--acc1),var(--acc2));font-weight:800}
    .row{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .switch{appearance:none;width:44px;height:26px;border-radius:999px;background:#2a374c;position:relative}
    .switch:checked{background:var(--acc2)}
    .switch:after{content:"";position:absolute;top:3px;left:3px;width:20px;height:20px;border-radius:50%;background:#fff;transition:.2s}
    .switch:checked:after{left:21px}
    .btn{width:100%;border:none;border-radius:14px;padding:16px;background:linear-gradient(135deg,var(--acc1),var(--acc2));color:#fff;font-weight:800;box-shadow:0 10px 24px #0006}
    .nav{position:fixed;left:0;right:0;bottom:0;height:56px;background:var(--card);display:flex;justify-content:space-around;align-items:center}
    .nav span{font-size:12px;color:var(--muted)}
    .ov{position:fixed;inset:0;background:#0007;display:none;align-items:center;justify-content:center;z-index:10}
    .card{width:260px;min-height:220px;background:var(--card);border-radius:16px;padding:16px;text-align:center;box-shadow:0 20px 40px #0008}
    .big{font-size:64px;margin:0 0 8px}
    .items{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px}
    .cell{background:var(--soft);border-radius:10px;padding:8px 4px}
    .mut{color:var(--muted);font-size:12px;margin-top:6px}
  </style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div class="ava" id="ava">U</div>
    <div class="title"><h1>Easy Star</h1><small id="uname">@user</small></div>
    <div class="pill"><span>‚≠ê</span><b id="bal">‚Äî</b></div>
    <div class="plus" id="add">+</div>
  </div>

  <div class="tabs">
    <div class="tab"><b>Classic</b><span id="pClassic">30‚≠ê</span></div>
    <div class="tab"><b>Lucky</b><span id="pLucky">45‚≠ê</span></div>
  </div>

  <div class="grid" id="grid"></div>

  <div class="panel">
    <div class="chips" id="chips">
      <div class="chip active" data-n="1">1</div>
      <div class="chip" data-n="2">2</div>
      <div class="chip" data-n="3">3</div>
      <div class="chip" data-n="4">4</div>
      <div class="chip" data-n="5">5</div>
    </div>
    <div class="row">
      <div class="mut">Fast</div>
      <input type="checkbox" id="fast" class="switch"/>
    </div>
    <button class="btn" id="spin">Try Your Luck ‚Äî <span id="price">30</span> ‚≠ê</button>
  </div>

  <div class="nav">
    <div>üéÅ<br/><span>Home</span></div>
    <div>üõ†Ô∏è<br/><span>Upgrade</span></div>
    <div>üèÜ<br/><span>Leaders</span></div>
    <div>üë§<br/><span>Profile</span></div>
    <div>üïì<br/><span>History</span></div>
  </div>
</div>

<div class="ov" id="ov">
  <div class="card" id="res">
    <div class="big" id="big">üéÅ</div>
    <b id="ttl">–ü–æ–¥–∞—Ä–æ–∫</b>
    <div class="items" id="multi"></div>
    <div class="mut">–ò—Ç–æ–≥ –ø—Ä–∏—Å–ª–∞–Ω –≤ —á–∞—Ç –±–æ—Ç–æ–º</div>
  </div>
</div>

<script>
const tg = window.Telegram.WebApp; tg.expand(); tg.ready();
const u = tg.initDataUnsafe?.user || {};
document.getElementById('ava').textContent = (u.first_name||'U').slice(0,1).toUpperCase();
document.getElementById('uname').textContent = u.username?('@'+u.username):'Mini App';
document.getElementById('bal').textContent = '‚Äî';

// –ø—Ä–µ–¥–º–µ—Ç—ã (–¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)
const ITEMS = [
  {k:'diamond_100',e:'üíé',t:'–ë—Ä–∏–ª–ª–∏–∞–Ω—Ç',p:100},
  {k:'ring_100',   e:'üíç',t:'–ö–æ–ª—å—Ü–æ',   p:100},
  {k:'trophy_100', e:'üèÜ',t:'–ö—É–±–æ–∫',    p:100},
  {k:'rocket_50',  e:'üöÄ',t:'–†–∞–∫–µ—Ç–∞',   p:50},
  {k:'bouquet_50', e:'üíê',t:'–ë—É–∫–µ—Ç',    p:50},
  {k:'cake_50',    e:'üéÇ',t:'–¢–æ—Ä—Ç',     p:50},
  {k:'champagne_50',e:'üçæ',t:'–®–∞–º–ø–∞–Ω—Å–∫–æ–µ',p:50},
  {k:'present_25', e:'üéÅ',t:'–ü–æ–¥–∞—Ä–æ–∫',  p:25},
  {k:'rose_25',    e:'üåπ',t:'–†–æ–∑–∞',     p:25},
  {k:'bear_15',    e:'üß∏',t:'–ú–∏—à–∫–∞',    p:15},
  {k:'heart_15',   e:'‚ù§Ô∏è',t:'–°–µ—Ä–¥—Ü–µ',   p:15},
  {k:'nft_rare',   e:'üßø',t:'NFT (—Ä–µ–¥–∫–∏–π)',p:0},
];

const PROBS_CLASSIC = {
  heart_15:0.30,bear_15:0.20,present_25:0.15,rose_25:0.08,cake_50:0.07,bouquet_50:0.06,rocket_50:0.05,champagne_50:0.04,trophy_100:0.02,ring_100:0.015,diamond_100:0.01,nft_rare:0.005
};
const PROBS_LUCKY = {
  heart_15:0.24,bear_15:0.18,present_25:0.14,rose_25:0.09,cake_50:0.07,bouquet_50:0.07,rocket_50:0.07,champagne_50:0.06,trophy_100:0.03,ring_100:0.02,diamond_100:0.014,nft_rare:0.01
};

const CASES = {
  classic:{name:'Classic Case',price:30,probs:PROBS_CLASSIC},
  lucky:{name:'Lucky Case',price:45,probs:PROBS_LUCKY}
};
let currentCase='classic';
document.getElementById('price').textContent = CASES[currentCase].price;
document.getElementById('pClassic').textContent = CASES.classic.price+'‚≠ê';
document.getElementById('pLucky').textContent = CASES.lucky.price+'‚≠ê';

// –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–µ–π—Å–æ–≤
const grid=document.getElementById('grid');
grid.innerHTML = `
  <div class="case" data-case="classic">
    <div class="badge">Default</div>
    <div class="nm">Classic Case</div>
    <div class="pr"><span>–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π</span><b>‚≠ê ${CASES.classic.price}</b></div>
  </div>
  <div class="case" data-case="lucky">
    <div class="badge">New</div>
    <div class="nm">Lucky Case</div>
    <div class="pr"><span>–ë–æ–ª—å—à–µ –¥–æ—Ä–æ–≥–∏—Ö</span><b>‚≠ê ${CASES.lucky.price}</b></div>
  </div>
`;
[...grid.querySelectorAll('.case')].forEach(el=>{
  el.onclick=()=>{
    currentCase=el.dataset.case;
    document.getElementById('price').textContent=CASES[currentCase].price;
    tg.HapticFeedback?.impactOccurred?.('light');
  };
});

// –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
document.getElementById('add').onclick=()=>{
  tg.sendData(JSON.stringify({a:'balance_menu'}));
};

// –≤—ã–±–æ—Ä —Å–ø–∏–Ω–æ–≤
let spins=1;
document.getElementById('chips').querySelectorAll('.chip').forEach(ch=>{
  ch.onclick=()=>{
    document.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
    ch.classList.add('active'); spins=parseInt(ch.dataset.n||'1',10);
  };
});

// –æ–≤–µ—Ä–ª–µ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
const ov=document.getElementById('ov');
const big=document.getElementById('big');
const ttl=document.getElementById('ttl');
const multi=document.getElementById('multi');

function weightedPick(probs){
  const keys=Object.keys(probs);
  let r=Math.random(),acc=0;
  for(const k of keys){ acc+=probs[k]; if(r<acc) return k; }
  return keys[keys.length-1];
}
function showResult(keys){
  ov.style.display='flex';
  if(keys.length===1){
    const it=ITEMS.find(x=>x.k===keys[0])||{e:'üéÅ',t:'–ü–æ–¥–∞—Ä–æ–∫'};
    big.textContent=it.e; ttl.textContent=it.t; multi.innerHTML='';
  }else{
    big.textContent='üéâ'; ttl.textContent='–†–µ–∑—É–ª—å—Ç–∞—Ç—ã'; multi.innerHTML='';
    keys.forEach(k=>{
      const it=ITEMS.find(x=>x.k===k)||{e:'üéÅ',t:'–ü–æ–¥–∞—Ä–æ–∫'};
      const cell=document.createElement('div'); cell.className='cell';
      cell.innerHTML=`<div style="font-size:28px">${it.e}</div><div style="font-size:12px">${it.t}</div>`;
      multi.appendChild(cell);
    });
  }
  setTimeout(()=>{ov.style.display='none';}, 1500);
}

// –∫–Ω–æ–ø–∫–∞ —Å–ø–∏–Ω–∞
const fast=document.getElementById('fast');
document.getElementById('spin').onclick=()=>{
  const cfg=CASES[currentCase];
  const local=[];
  for(let i=0;i<spins;i++) local.push(weightedPick(cfg.probs));
  showResult(local);
  tg.HapticFeedback?.impactOccurred?.(fast.checked?'light':'heavy');
  tg.sendData(JSON.stringify({a:'spin', case: currentCase, n: spins}));
};
</script>
</body>
</html>
