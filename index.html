<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Easy Star</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{ --bg:#101720; --card:#17202b; --soft:#1e2a38; --muted:#a6b7c7; --text:#eaf3fb;
           --acc1:#2ea6ff; --acc2:#00d0a8; --star:#ffd15c; --r:14px; }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
    .wrap{padding-bottom:96px}
    .header{display:flex;align-items:center;gap:12px;padding:12px 14px}
    .ava{width:42px;height:42px;border-radius:50%;background:#253348;display:grid;place-items:center;font-weight:800}
    .title{flex:1} .title h1{margin:0;font-size:18px} .title small{color:var(--muted)}
    .pill{display:flex;gap:8px;align-items:center;background:var(--card);border-radius:999px;padding:8px 10px}
    .plus{width:36px;height:36px;display:grid;place-items:center;border-radius:999px;background:linear-gradient(135deg,var(--acc1),var(--acc2));font-weight:800}
    .tabs{display:flex;gap:10px;padding:0 14px;margin-top:4px}
    .tab{flex:1;background:var(--card);border-radius:12px;padding:10px 12px;display:flex;justify-content:space-between;align-items:center;cursor:pointer}
    .tab.active{outline:2px solid #2ea6ff66}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:12px 14px}
    .case{background:var(--card);border-radius:var(--r);padding:14px;position:relative;cursor:pointer}
    .case .badge{position:absolute;top:8px;right:8px;font-size:12px;background:#273447;color:#9cd;padding:4px 7px;border-radius:10px}
    .case .pic{font-size:48px;line-height:1;margin-bottom:8px}
    .case .nm{font-weight:800;margin:0 0 4px}
    .case .desc{color:var(--muted);font-size:13px;margin-bottom:8px}
    .case .price{display:flex;align-items:center;gap:6px;color:#ffd15c;font-weight:800}
    .case .open{margin-top:8px;width:100%;border:none;border-radius:12px;padding:10px;background:linear-gradient(135deg,var(--acc1),var(--acc2));color:#fff;font-weight:800}
    .panel{position:fixed;left:0;right:0;bottom:56px;background:var(--soft);border-top-left-radius:16px;border-top-right-radius:16px;padding:10px 12px}
    .chips{display:flex;gap:8px;margin-bottom:10px}
    .chip{flex:1;background:#233041;padding:10px 0;border-radius:12px;text-align:center;cursor:pointer}
    .chip.active{background:linear-gradient(135deg,var(--acc1),var(--acc2));font-weight:800}
    .row{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .switch{appearance:none;width:44px;height:26px;border-radius:999px;background:#2a374c;position:relative;cursor:pointer}
    .switch:checked{background:var(--acc2)}
    .switch:after{content:"";position:absolute;top:3px;left:3px;width:20px;height:20px;border-radius:50%;background:#fff;transition:.2s}
    .switch:checked:after{left:21px}
    .btn{width:100%;border:none;border-radius:14px;padding:16px;background:linear-gradient(135deg,var(--acc1),var(--acc2));color:#fff;font-weight:800;box-shadow:0 10px 24px #0006}
    .nav{position:fixed;left:0;right:0;bottom:0;height:56px;background:var(--card);display:flex;justify-content:space-around;align-items:center}
    .nav .item{width:20%;text-align:center;cursor:pointer}
    .nav .item span{display:block;font-size:12px;color:var(--muted)}
    .ov{position:fixed;inset:0;background:#0007;display:none;align-items:center;justify-content:center;z-index:10}
    .card{width:260px;min-height:220px;background:var(--card);border-radius:16px;padding:16px;text-align:center;box-shadow:0 20px 40px #0008}
    .big{font-size:64px;margin:0 0 8px}
    .items{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px}
    .cell{background:var(--soft);border-radius:10px;padding:8px 4px}
    .mut{color:var(--muted);font-size:12px;margin-top:6px}
  </style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div class="ava" id="ava">U</div>
    <div class="title"><h1>Easy Star</h1><small id="uname">@user</small></div>
    <div class="pill"><span>‚≠ê</span><b id="bal">‚Äî</b></div>
    <div class="plus" id="add">+</div>
  </div>

  <div class="tabs">
    <div class="tab active" id="tabClassic"><b>Classic</b><span>30‚≠ê</span></div>
    <div class="tab" id="tabLucky"><b>Lucky</b><span>45‚≠ê</span></div>
  </div>

  <div class="grid" id="grid"></div>

  <div class="panel">
    <div class="chips" id="chips">
      <div class="chip active" data-n="1">1</div>
      <div class="chip" data-n="2">2</div>
      <div class="chip" data-n="3">3</div>
      <div class="chip" data-n="4">4</div>
      <div class="chip" data-n="5">5</div>
    </div>
    <div class="row">
      <div class="mut">Fast</div>
      <input type="checkbox" id="fast" class="switch"/>
    </div>
    <button class="btn" id="spin">Try Your Luck ‚Äî <span id="price">30</span> ‚≠ê</button>
  </div>

  <div class="nav">
    <div class="item" id="navHome">üéÅ<span>Home</span></div>
    <div class="item" id="navUpg">üõ†Ô∏è<span>Upgrade</span></div>
    <div class="item" id="navLead">üèÜ<span>Leaders</span></div>
    <div class="item" id="navProf">üë§<span>Profile</span></div>
    <div class="item" id="navHist">üïì<span>History</span></div>
  </div>
</div>

<div class="ov" id="ov">
  <div class="card" id="res">
    <div class="big" id="big">üéÅ</div>
    <b id="ttl">–ü–æ–¥–∞—Ä–æ–∫</b>
    <div class="items" id="multi"></div>
    <div class="mut">–ò—Ç–æ–≥ –ø—Ä–∏—Å–ª–∞–Ω –≤ —á–∞—Ç –±–æ—Ç–æ–º</div>
  </div>
</div>

<script>
const tg = window.Telegram.WebApp; tg.expand(); tg.ready();
const u = tg.initDataUnsafe?.user || {};
document.getElementById('ava').textContent = (u.first_name||'U').slice(0,1).toUpperCase();
document.getElementById('uname').textContent = u.username?('@'+u.username):'Mini App';
document.getElementById('bal').textContent = '‚Äî';

// –ø—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
const ITEMS = [
  {k:'diamond_100',e:'üíé',t:'–ë—Ä–∏–ª–ª–∏–∞–Ω—Ç',p:100},
  {k:'ring_100',   e:'üíç',t:'–ö–æ–ª—å—Ü–æ',   p:100},
  {k:'trophy_100', e:'üèÜ',t:'–ö—É–±–æ–∫',    p:100},
  {k:'rocket_50',  e:'üöÄ',t:'–†–∞–∫–µ—Ç–∞',   p:50},
  {k:'bouquet_50', e:'üíê',t:'–ë—É–∫–µ—Ç',    p:50},
  {k:'cake_50',    e:'üéÇ',t:'–¢–æ—Ä—Ç',     p:50},
  {k:'champagne_50',e:'üçæ',t:'–®–∞–º–ø–∞–Ω—Å–∫–æ–µ',p:50},
  {k:'present_25', e:'üéÅ',t:'–ü–æ–¥–∞—Ä–æ–∫',  p:25},
  {k:'rose_25',    e:'üåπ',t:'–†–æ–∑–∞',     p:25},
  {k:'bear_15',    e:'üß∏',t:'–ú–∏—à–∫–∞',    p:15},
  {k:'heart_15',   e:'‚ù§Ô∏è',t:'–°–µ—Ä–¥—Ü–µ',   p:15},
  {k:'nft_rare',   e:'üßø',t:'NFT (—Ä–µ–¥–∫–∏–π)',p:0},
];
const PROBS_CLASSIC = {
  heart_15:0.30,bear_15:0.20,present_25:0.15,rose_25:0.08,cake_50:0.07,bouquet_50:0.06,rocket_50:0.05,champagne_50:0.04,trophy_100:0.02,ring_100:0.015,diamond_100:0.01,nft_rare:0.005
};
const PROBS_LUCKY = {
  heart_15:0.24,bear_15:0.18,present_25:0.14,rose_25:0.09,cake_50:0.07,bouquet_50:0.07,rocket_50:0.07,champagne_50:0.06,trophy_100:0.03,ring_100:0.02,diamond_100:0.014,nft_rare:0.01
};
const CASES = {
  classic:{name:'Classic Case',desc:'–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π',price:30,probs:PROBS_CLASSIC,emoji:'üéÅ'},
  lucky:{name:'Lucky Case',desc:'–ë–æ–ª—å—à–µ –¥–æ—Ä–æ–≥–∏—Ö',price:45,probs:PROBS_LUCKY,emoji:'üí†'},
};

let currentCase='classic';
document.getElementById('price').textContent = CASES[currentCase].price;

// –Ω–∞–≤–∏–≥–∞—Ü–∏—è
document.getElementById('navProf').onclick=()=>tg.sendData(JSON.stringify({a:'inventory'}));
document.getElementById('navHome').onclick=()=>window.scrollTo({top:0,behavior:'smooth'});
document.getElementById('navUpg').onclick=()=>tg.sendData(JSON.stringify({a:'balance_menu'}));
document.getElementById('navLead').onclick=()=>tg.sendData(JSON.stringify({a:'inventory'}));
document.getElementById('navHist').onclick=()=>tg.sendData(JSON.stringify({a:'inventory'}));

// –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
document.getElementById('add').onclick=()=>tg.sendData(JSON.stringify({a:'balance_menu'}));

// —Ç–∞–±—ã
const tC=document.getElementById('tabClassic'); const tL=document.getElementById('tabLucky');
tC.onclick=()=>selectCase('classic');
tL.onclick=()=>selectCase('lucky');
function selectCase(k){
  currentCase=k;
  tC.classList.toggle('active',k==='classic');
  tL.classList.toggle('active',k==='lucky');
  document.getElementById('price').textContent = CASES[currentCase].price;
  drawCases();
}

// –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–µ–π—Å–æ–≤ (–∫–∞–∂–¥–∞—è –∫–ª–∏–∫–∞–µ—Ç—Å—è + –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ ‚Äú–û—Ç–∫—Ä—ã—Ç—å‚Äù)
const grid = document.getElementById('grid');
function caseCard(key){
  const c=CASES[key];
  const badge = key==='classic'?'Default':'New';
  return `
    <div class="case" data-case="${key}">
      <div class="badge">${badge}</div>
      <div class="pic">${c.emoji}</div>
      <div class="nm">${c.name}</div>
      <div class="desc">${c.desc}</div>
      <div class="price"><span>‚≠ê</span><b>${c.price}</b></div>
      <button class="open" data-open="${key}">–û—Ç–∫—Ä—ã—Ç—å –∑–∞ ${c.price} ‚≠ê</button>
    </div>`;
}
function drawCases(){
  grid.innerHTML = caseCard('classic') + caseCard('lucky');
  // –∫–ª–∏–∫–∏ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ ‚Äî –≤—ã–±–∏—Ä–∞—é—Ç –∫–µ–π—Å
  grid.querySelectorAll('.case').forEach(el=>{
    el.onclick = (e)=>{
      // –µ—Å–ª–∏ –Ω–∞–∂–∞–ª–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É ‚Äî –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º
      if(e.target && e.target.dataset && e.target.dataset.open) return;
      selectCase(el.dataset.case);
      tg.HapticFeedback?.impactOccurred?.('light');
    };
  });
  // –∫–ª–∏–∫–∏ –ø–æ –∫–Ω–æ–ø–∫–µ ‚Äú–û—Ç–∫—Ä—ã—Ç—å‚Äù
  grid.querySelectorAll('button[data-open]').forEach(btn=>{
    btn.onclick = (e)=>{
      e.stopPropagation();
      const k = btn.dataset.open;
      selectCase(k);
      doSpin(); // 1 –∫–ª–∏–∫–æ–º –æ—Ç–∫—Ä—ã–≤–∞–µ–º
    };
  });
}
drawCases();

// –≤—ã–±–æ—Ä —Å–ø–∏–Ω–æ–≤
let spins=1;
document.getElementById('chips').querySelectorAll('.chip').forEach(ch=>{
  ch.onclick=()=>{
    document.querySelectorAll('.chip').forEach(x=>x.classList.remove('active'));
    ch.classList.add('active'); spins=parseInt(ch.dataset.n||'1',10);
  };
});

// –æ–≤–µ—Ä–ª–µ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
const ov=document.getElementById('ov');
const big=document.getElementById('big');
const ttl=document.getElementById('ttl');
const multi=document.getElementById('multi');

function weightedPick(probs){
  const keys=Object.keys(probs);
  let r=Math.random(),acc=0;
  for(const k of keys){ acc+=probs[k]; if(r<acc) return k; }
  return keys[keys.length-1];
}
function showResult(keys){
  ov.style.display='flex';
  if(keys.length===1){
    const it=ITEMS.find(x=>x.k===keys[0])||{e:'üéÅ',t:'–ü–æ–¥–∞—Ä–æ–∫'};
    big.textContent=it.e; ttl.textContent=it.t; multi.innerHTML='';
  }else{
    big.textContent='üéâ'; ttl.textContent='–†–µ–∑—É–ª—å—Ç–∞—Ç—ã'; multi.innerHTML='';
    keys.forEach(k=>{
      const it=ITEMS.find(x=>x.k===k)||{e:'üéÅ',t:'–ü–æ–¥–∞—Ä–æ–∫'};
      const cell=document.createElement('div'); cell.className='cell';
      cell.innerHTML=`<div style="font-size:28px">${it.e}</div><div style="font-size:12px">${it.t}</div>`;
      multi.appendChild(cell);
    });
  }
  setTimeout(()=>{ov.style.display='none';}, 1500);
}

// –∫–Ω–æ–ø–∫–∞ ‚ÄúTry Your Luck‚Äù
const fast=document.getElementById('fast');
document.getElementById('spin').onclick=()=>doSpin();
function doSpin(){
  const cfg=CASES[currentCase];
  const local=[];
  for(let i=0;i<spins;i++) local.push(weightedPick(cfg.probs));
  showResult(local);
  tg.HapticFeedback?.impactOccurred?.(fast.checked?'light':'heavy');
  tg.sendData(JSON.stringify({a:'spin', case: currentCase, n: spins}));
}
</script>
</body>
</html>
